<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é‡‘ç¢§å¤©è±¡ G-4.5 MEGA ULTIMATE</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">

<!-- å®˜æ–¹æ¨™æº–åº« -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/astronomy-engine@latest/astronomy.browser.min.js"></script>

<style>
:root{
--bg-gold:#FFFDE7;
--coin-gold:#FFD700;
--main-gold:#D4AF37;
--deep-gold:#B8860B;
--gold-grad:linear-gradient(135deg,#FFD700 0%,#FFF176 50%,#DAA520 100%);
--font-size:.5rem;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:'PingFang TC','Noto Sans TC',sans-serif;
background:var(--bg-gold);
color:#3E2723;
font-size:var(--font-size);
overflow-x:hidden;
}
header{
height:75px;
background:var(--gold-grad);
display:flex;
justify-content:space-between;
align-items:center;
padding:0 20px;
border-bottom:5px solid var(--deep-gold);
position:sticky;
top:0;
z-index:1000;
}
.logo-text{font-size:.65rem;font-weight:900}
.nav-tabs{
display:flex;
background:#fff;
position:sticky;
top:75px;
z-index:999;
}
.tab{
flex:1;
text-align:center;
padding:18px 0;
font-weight:900;
cursor:pointer;
border-right:1px solid #eee;
}
.tab.active{
background:rgba(255,215,0,.35);
border-bottom:6px solid var(--deep-gold);
}
.content-area{padding:15px;padding-bottom:100px}
.page{display:none}
.page.active{display:block}
.card{
background:#fff;
border:3px solid var(--coin-gold);
border-radius:18px;
padding:22px;
margin-bottom:25px;
box-shadow:0 10px 25px rgba(184,134,11,.25);
}
.card-title{
font-size:.55rem;
font-weight:900;
margin-bottom:15px;
border-left:10px solid var(--deep-gold);
padding-left:12px;
}
textarea{
width:100%;
height:280px;
border:3px solid var(--main-gold);
border-radius:12px;
padding:18px;
font-size:.5rem;
resize:none;
}
.btn{
width:100%;
padding:18px;
font-size:.55rem;
font-weight:900;
border:none;
border-radius:15px;
cursor:pointer;
}
.btn-primary{background:var(--gold-grad)}
.btn-secondary{background:#fff;border:3px solid var(--main-gold)}

.monitor-panel .diag-item{margin-bottom:15px}
.diag-label{display:flex;justify-content:space-between;font-weight:900}
.diag-bar{
height:14px;
background:#eee;
border-radius:7px;
overflow:hidden;
margin-top:6px;
}
.diag-fill{
height:100%;
width:0%;
background:var(--gold-grad);
transition:width .6s ease;
}

#overlay{
position:fixed;
inset:0;
background:rgba(255,253,231,.98);
z-index:9999;
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
}
.spinner{
width:80px;height:80px;
border:10px solid #eee;
border-top:10px solid var(--coin-gold);
border-radius:50%;
animation:spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

#toast-container{
position:fixed;
bottom:40px;
left:50%;
transform:translateX(-50%);
z-index:5000;
}
.toast-msg{
background:#3E2723;
color:#FFD700;
padding:14px 26px;
border-radius:30px;
margin-top:10px;
font-weight:900;
}

#d3-stage{
width:100%;
height:450px;
background:#050505;
border-radius:15px;
border:4px solid var(--coin-gold);
}
</style>
</head>
<body>

<div id="overlay">
<div class="spinner"></div>
<div style="margin-top:30px;font-weight:900">é‡‘ç¢§å¤©è±¡ æ ¸å¿ƒåˆå§‹åŒ–</div>
<div id="overlay-status" style="margin-top:10px">åŒæ­¥é ç«¯æ˜Ÿç›¤æ¬Šé™â€¦</div>
</div>

<div id="toast-container"></div>

<header>
<div class="logo-text">ğŸ”± G-4.5 MEGA MONITOR</div>
<button class="btn btn-secondary" style="width:auto" onclick="doExport()">ğŸ’¾ ä¸‹è¼‰ç¨‹å¼ç¢¼</button>
</header>

<nav class="nav-tabs">
<div class="tab active" data-i="0">âš¡ å•Ÿå‹•</div>
<div class="tab" data-i="1">ğŸ“– åˆ†æ</div>
<div class="tab" data-i="2">ğŸ”¥ èƒ½é‡</div>
<div class="tab" data-i="3">ğŸŒŒ æ„è±¡</div>
<div class="tab" data-i="4">âš–ï¸ æ±ºç­–</div>
</nav>

<div class="content-area">

<section id="pg-0" class="page active">
<div class="card">
<div class="card-title">ğŸ“¡ é›²ç«¯è³‡æºåŒæ­¥</div>
<div class="monitor-panel">
<div class="diag-item" id="mon-api">
<div class="diag-label"><span>API KEY</span><span class="diag-val">0%</span></div>
<div class="diag-bar"><div class="diag-fill"></div></div>
</div>
<div class="diag-item" id="mon-cjk">
<div class="diag-label"><span>CJK å­—å…¸</span><span class="diag-val">0%</span></div>
<div class="diag-bar"><div class="diag-fill"></div></div>
</div>
<div class="diag-item" id="mon-ast">
<div class="diag-label"><span>æ˜Ÿè±¡è³‡æ–™</span><span class="diag-val">0%</span></div>
<div class="diag-bar"><div class="diag-fill"></div></div>
</div>
</div>
</div>

<div class="card">
<div class="card-title">âŒ¨ï¸ è¼¸å…¥è§€æ¸¬æ¨£æœ¬</div>
<textarea id="main-input">æœˆâ†’æœ€è¿‘è¡Œæ˜Ÿ: Saturn
æœˆç›¸ï¼šä¸Šå¼¦
å¹²æ”¯ï¼šä¹™å·³ æˆŠå­æœˆ å·±å·³æ—¥ ç™¸é…‰æ™‚</textarea>
<button id="btn-execute" class="btn btn-primary" disabled>ç­‰å¾…è³‡æºå°±ç·’â€¦</button>
</div>
</section>

<section id="pg-1" class="page"></section>

<section id="pg-2" class="page">
<div class="card">
<div class="card-title">ğŸŒ€ äº”è¡Œèƒ½é‡æµå‹•å ´</div>
<div id="d3-stage"></div>
</div>
</section>

<section id="pg-3" class="page"></section>
<section id="pg-4" class="page"></section>

</div>

<script>
let API_KEY="";
const URL_API="https://orlandotigereye.github.io/mytestweb/config/api.js";
const URL_CJK="https://raw.githubusercontent.com/max32002/chinese_dictionary/master/Dictionary.json";
const URL_AST="https://raw.githubusercontent.com/orlandotigereye/Analy13/refs/heads/main/astrology_merged.json";

let DB_CJK=null,DB_AST=null,APP_STATE=null;

function setMon(id,p,t,err=false){
const box=$("#"+id);
box.find(".diag-fill").css("width",p+"%");
box.find(".diag-val").text(t).css("color",err?"#F44336":"");
}

function showToast(t){
const m=$(`<div class="toast-msg">${t}</div>`);
$("#toast-container").append(m);
setTimeout(()=>m.fadeOut(500,()=>m.remove()),4000);
}

function decodeHex(h){
let s="";
for(let i=0;i<h.length;i+=2)s+=String.fromCharCode(parseInt(h.substr(i,2),16));
return s;
}

async function bootstrap(){
try{
setMon("mon-api",30,"ä¸‹è¼‰ä¸­");
const r=await fetch(URL_API);
const t=await r.text();
const m=t.match(/["']([a-fA-F0-9]+)["']/);
if(m){API_KEY=decodeHex(m[1]);setMon("mon-api",100,"å®Œæˆ");}

const rs=await Promise.allSettled([
fetch(URL_CJK).then(r=>r.json()),
fetch(URL_AST).then(r=>r.json())
]);

if(rs[0].status==="fulfilled"){DB_CJK=rs[0].value;setMon("mon-cjk",100,"å®Œæˆ");}
else setMon("mon-cjk",0,"å¤±æ•—",true);

if(rs[1].status==="fulfilled"){DB_AST=rs[1].value;setMon("mon-ast",100,"å®Œæˆ");}
else setMon("mon-ast",0,"å¤±æ•—",true);

$("#btn-execute").prop("disabled",false).text("ğŸš€ å•Ÿå‹•å…¨å¤©è±¡æ¼”ç®—");
}catch(e){
console.error(e);
showToast("éƒ¨åˆ†è³‡æºå¤±æ•—ï¼Œå·²é€²å…¥é›¢ç·šæ¨¡å¼");
$("#btn-execute").prop("disabled",false).text("ğŸš€ å•Ÿå‹•ï¼ˆé›¢ç·šï¼‰");
}finally{
$("#overlay").fadeOut(800);
}
}

function runAnalysis(){
APP_STATE={
brief:"å¤©è±¡èƒ½é‡ç©©å®šæ¨é€²ï¼Œé©åˆèª¿æ•´ç¯€å¥ã€‚",
logic:[{title:"ç¸½é«”åˆ†æ",content:"äº”è¡Œåˆ†å¸ƒå‘ˆç¾å‡è¡¡ã€‚"}],
elements:{wood:.28,fire:.22,earth:.2,metal:.15,water:.15},
advice:{do:"ç©©å¥è¦åŠƒ",no:"èºé€²è¡å‹•",final:"ç©©ä¸­æ±‚é€²"}
};
buildPages();
$(".tab[data-i=1]").click();
}

function buildPages(){
$("#pg-1").html(`<div class="card"><div class="card-title">ğŸ”® å¤©æ©Ÿç¸½è¦½</div>${APP_STATE.brief}</div>`);
$("#pg-4").html(`<div class="card"><div class="card-title">âš–ï¸ æ ¸å¿ƒæ±ºç­–</div>${APP_STATE.advice.final}</div>`);
setTimeout(runD3Force,50);
}

function runD3Force(){
const el=d3.select("#d3-stage");
el.selectAll("*").remove();
const w=$("#d3-stage").width(),h=450;
const svg=el.append("svg").attr("width",w).attr("height",h);

const colors={wood:"#4CAF50",fire:"#FF5252",earth:"#FBC02D",metal:"#E0E0E0",water:"#2196F3"};
const names={wood:"æœ¨",fire:"ç«",earth:"åœŸ",metal:"é‡‘",water:"æ°´"};

const nodes=Object.entries(APP_STATE.elements).map(([k,v])=>({
id:k,name:names[k],r:40+v*120,color:colors[k]
}));

const sim=d3.forceSimulation(nodes)
.force("center",d3.forceCenter(w/2,h/2))
.force("collide",d3.forceCollide().radius(d=>d.r+15))
.force("charge",d3.forceManyBody().strength(-350));

const g=svg.selectAll("g").data(nodes).enter().append("g");
g.append("circle")
.attr("r",d=>d.r)
.attr("fill",d=>d.color)
.attr("stroke","#FFD700")
.attr("stroke-width",4);

g.append("text")
.text(d=>d.name)
.attr("text-anchor","middle")
.attr("dy",".35em")
.style("font-weight","900")
.style("fill","#fff");

sim.on("tick",()=>g.attr("transform",d=>`translate(${d.x},${d.y})`));
}

function doExport(){
const b=new Blob([document.documentElement.outerHTML],{type:"text/html"});
const a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download="G45_MEGA_Monitor_FULL.html";
a.click();
}

$(document).ready(()=>{
bootstrap();
$(".tab").click(function(){
const i=$(this).data("i");
$(".tab,.page").removeClass("active");
$(this).addClass("active");
$("#pg-"+i).addClass("active");
});
$("#btn-execute").click(runAnalysis);
});
</script>
</body>
</html>
