<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é‡‘å¹£è¼ç…Œ Gemini AI æ¸¬è©¦å·¥å…·</title>
    <style>
        :root {
            --gold-primary: #ffd700;
            --gold-dark: #b8860b;
            --gold-light: #fffacd;
            --bg-color: #fff8e1;
        }

        /* åš´æ ¼æ§åˆ¶æ–‡å­—å¤§å° 0.5remï¼Œç¢ºä¿æ‰€æœ‰ç’°å¢ƒä¸€è‡´ */
        * {
            box-sizing: border-box;
            font-size: 0.5rem !important;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: radial-gradient(circle, var(--gold-light) 0%, var(--gold-primary) 100%);
            background-attachment: fixed;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #5d4037;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            width: 100vw;
            overflow-x: hidden;
            padding: 10px;
        }

        /* é‡‘å¹£èƒŒæ™¯è£é£¾ - ç¢ºä¿åœ¨å„ç¨®å¯¬åº¦ä¸‹ä¸æº¢å‡º */
        body::before {
            content: "ğŸ’°";
            position: fixed;
            font-size: 10rem !important;
            opacity: 0.1;
            z-index: -1;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .container {
            width: 100%;
            max-width: 100%;
            background: rgba(255, 255, 255, 0.92);
            border: 2px solid var(--gold-dark);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 8px 16px rgba(184, 134, 11, 0.4);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .header {
            text-align: center;
            border-bottom: 2px solid var(--gold-primary);
            padding-bottom: 5px;
        }

        .header h1 {
            font-size: 0.8rem !important;
            color: var(--gold-dark);
            font-weight: bold;
        }

        /* æŒ‰éˆ•ç¾¤çµ„é©é… RWD */
        .btn-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        button {
            background: linear-gradient(to bottom, var(--gold-primary), var(--gold-dark));
            border: 1px solid #8b4513;
            color: white;
            padding: 10px 2px;
            border-radius: 6px;
            cursor: pointer;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.4);
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
        }

        button:active {
            filter: brightness(0.8);
            transform: scale(0.98);
        }

        /* ç‹€æ…‹é¡¯ç¤ºå€ */
        #status {
            background: #ffffff;
            border: 1px solid var(--gold-primary);
            padding: 6px;
            min-height: 30px;
            color: #b71c1c;
            border-radius: 4px;
            word-break: break-all;
            line-height: 1.2;
        }

        /* è³‡æ–™èˆ‡ AI å…§å®¹é¡¯ç¤ºå€ */
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .data-view {
            background: #fdfaf0;
            border: 1px solid #d4a017;
            padding: 8px;
            height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            border-radius: 4px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
        }

        /* åˆ†é åˆ‡æ› */
        .pagination {
            display: flex;
            justify-content: space-around;
            padding: 5px 0;
            background: rgba(184, 134, 11, 0.1);
            border-radius: 6px;
        }

        .page-btn {
            background: none;
            border: none;
            color: var(--gold-dark);
            padding: 5px 15px;
            text-decoration: underline;
            box-shadow: none;
            flex: none;
        }

        .page-btn.active {
            color: #ffffff;
            background: var(--gold-dark);
            text-decoration: none;
            border-radius: 4px;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loader {
            display: none;
            text-align: center;
            font-weight: bold;
            color: var(--gold-dark);
            padding: 5px;
        }

        .line-count {
            position: fixed;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.75);
            color: #ffd700;
            padding: 2px 6px;
            border-radius: 3px;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Gemini AI å…¨ç’°å¢ƒçµ±ä¸€æ¸¬è©¦å·¥å…· (Hex)</h1>
    </div>

    <div id="status">æº–å‚™å°±ç·’ã€‚ç’°å¢ƒæª¢æŸ¥ï¼šOK</div>

    <div class="btn-group">
        <button onclick="fetchAndProcessData()">1. ç²å–è³‡æ–™/è½‰ Hex</button>
        <button onclick="pingGemini()">2. é€£ç·šæ¸¬è©¦ (Ping)</button>
        <button onclick="runAiAnalysis()">3. AI çµæ§‹åˆ†æ</button>
        <button onclick="downloadSelf()">ä¸‹è¼‰æ­¤å·¥å…·</button>
    </div>

    <div id="ai-loader" class="loader">æ­£åœ¨è™•ç†ä¸­... è«‹ç¨å€™...</div>

    <div class="content-area">
        <div id="view-data" class="data-view">å°šæœªè¼‰å…¥è³‡æ–™ã€‚</div>
        <div id="view-ai" class="data-view" style="display:none;">AI çµæœå°‡åœ¨æ­¤è™•å‘ˆç¾ã€‚</div>
    </div>

    <div class="pagination">
        <div class="page-btn active" id="btn-data" onclick="switchTab('data')">è³‡æ–™é è¦½</div>
        <div class="page-btn" id="btn-ai" onclick="switchTab('ai')">AI å ±å‘Š</div>
    </div>
</div>

<div class="line-count" id="lineCountDisplay">ç›®å‰è¡Œæ•¸: 0</div>

<script>
    const CONFIG = {
        apiUrl: "https://orlandotigereye.github.io/mytestweb/config/api.js",
        geminiUrl: "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent",
        apiKey: "" // API Key æœƒç”±ç³»çµ±æ³¨å…¥
    };

    let sharedRawContent = "";

    function setLog(msg) {
        document.getElementById('status').innerText = msg;
    }

    function toHex(str) {
        return "0x" + Array.from(str).map(c => c.charCodeAt(0).toString(16).toUpperCase().padStart(2, '0')).join('');
    }

    async function fetchAndProcessData() {
        setLog("æ­£åœ¨é€£ç·šè‡³ Github ç²å– api.js...");
        try {
            const resp = await fetch(`${CONFIG.apiUrl}?v=${Date.now()}`);
            if (!resp.ok) throw new Error("é ç«¯é€£ç·šå¤±æ•—: " + resp.status);
            const text = await resp.respText ? await resp.respText() : await resp.text();
            sharedRawContent = text;

            let output = "// çµ±ä¸€ç’°å¢ƒè™•ç†çµæœ (Key è½‰ Hex)\n\n";
            const lines = text.split('\n');
            lines.forEach(line => {
                const match = line.match(/^\s*["']?([\w-]+)["']?\s*:/);
                if (match) {
                    const key = match[1];
                    const hex = toHex(key);
                    output += line.replace(key, hex) + " // åŸéµ: " + key + "\n";
                } else {
                    output += line + "\n";
                }
            });

            document.getElementById('view-data').innerText = output;
            switchTab('data');
            setLog("è³‡æ–™è™•ç†æˆåŠŸã€‚");
            updateLines();
        } catch (e) {
            setLog("ç™¼ç”ŸéŒ¯èª¤: " + e.message);
        }
    }

    async function callGemini(prompt, systemPrompt = "") {
        const url = `${CONFIG.geminiUrl}?key=${CONFIG.apiKey}`;
        const payload = {
            contents: [{ parts: [{ text: prompt }] }]
        };
        if (systemPrompt) {
            payload.systemInstruction = { parts: [{ text: systemPrompt }] };
        }

        let retryCount = 0;
        const maxRetries = 5;

        while (retryCount < maxRetries) {
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || "HTTP " + response.status);
                }

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "ç„¡å…§å®¹å›å‚³";
            } catch (err) {
                retryCount++;
                if (retryCount >= maxRetries) throw err;
                const backoff = Math.pow(2, retryCount) * 1000;
                setLog(`é€šè¨Šé‡è©¦ä¸­ (${retryCount}/5)...`);
                await new Promise(resolve => setTimeout(resolve, backoff));
            }
        }
    }

    async function pingGemini() {
        setLog("ç™¼é€æ¸¬è©¦ä¿¡è™Ÿè‡³ Gemini...");
        document.getElementById('ai-loader').style.display = "block";
        try {
            const res = await callGemini("ç³»çµ±é€£ç·šæ¸¬è©¦ï¼Œè«‹å›è¦†ï¼šé€£ç·šæ­£å¸¸ã€‚");
            document.getElementById('view-ai').innerText = "é€£ç·šæ¸¬è©¦æˆåŠŸå›å‚³ï¼š\n" + res;
            switchTab('ai');
            setLog("Gemini API é€šè¨ŠæˆåŠŸã€‚");
        } catch (e) {
            setLog("API æ¸¬è©¦å¤±æ•—: " + e.message);
        } finally {
            document.getElementById('ai-loader').style.display = "none";
            updateLines();
        }
    }

    async function runAiAnalysis() {
        if (!sharedRawContent) return setLog("è«‹å…ˆåŸ·è¡Œã€Œç²å–è³‡æ–™ã€ã€‚");
        setLog("AI æ­£åœ¨åˆ†æè³‡æ–™çµæ§‹...");
        document.getElementById('ai-loader').style.display = "block";
        try {
            const prompt = `åˆ†æä»¥ä¸‹ API è¨­å®šæª”å…§å®¹ä¸¦ç¸½çµå…¶åŠŸèƒ½ï¼š\n${sharedRawContent}`;
            const sys = "ä½ æ˜¯ä¸€å€‹è³‡æ·±å·¥ç¨‹å¸«ï¼Œè«‹ç”¨ç¹é«”ä¸­æ–‡ç°¡è¦åˆ†æã€‚";
            const res = await callGemini(prompt, sys);
            document.getElementById('view-ai').innerText = "AI åˆ†æå ±å‘Šï¼š\n" + res;
            switchTab('ai');
            setLog("AI åˆ†æå®Œæˆã€‚");
        } catch (e) {
            setLog("åˆ†æå¤±æ•—: " + e.message);
        } finally {
            document.getElementById('ai-loader').style.display = "none";
            updateLines();
        }
    }

    function switchTab(type) {
        const dView = document.getElementById('view-data');
        const aView = document.getElementById('view-ai');
        const dBtn = document.getElementById('btn-data');
        const aBtn = document.getElementById('btn-ai');

        if (type === 'data') {
            dView.style.display = "block";
            aView.style.display = "none";
            dBtn.classList.add('active');
            aBtn.classList.remove('active');
        } else {
            dView.style.display = "none";
            aView.style.display = "block";
            aBtn.classList.add('active');
            dBtn.classList.remove('active');
        }
    }

    function downloadSelf() {
        try {
            const content = document.documentElement.outerHTML;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gemini_universal_test.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            setLog("ç¨‹å¼ç¢¼ä¸‹è¼‰å•Ÿå‹•ã€‚");
        } catch (e) {
            setLog("ä¸‹è¼‰å‡ºéŒ¯: " + e.message);
        }
    }

    function updateLines() {
        const total = document.documentElement.outerHTML.split('\n').length;
        document.getElementById('lineCountDisplay').innerText = "ç›®å‰è¨ˆç®—å¯¦éš›è¡Œæ•¸: " + total;
    }

    window.onload = updateLines;
</script>
</body>
</html>

