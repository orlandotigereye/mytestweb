<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡‘å¹£è¼ç…Œ Gemini AI æ¸¬è©¦å·¥å…·</title>
    <style>
        :root {
            --gold-primary: #ffd700;
            --gold-dark: #b8860b;
            --gold-light: #fffacd;
            --bg-color: #fff8e1;
        }

        /* åš´æ ¼æ§åˆ¶æ–‡å­—å¤§å° 0.5rem */
        * {
            box-sizing: border-box;
            font-size: 0.5rem !important;
        }

        body {
            margin: 0;
            padding: 10px;
            background: radial-gradient(circle, var(--gold-light) 0%, var(--gold-primary) 100%);
            background-attachment: fixed;
            font-family: sans-serif;
            color: #5d4037;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* é‡‘å¹£èƒŒæ™¯è£é£¾ */
        body::before {
            content: "ğŸ’°";
            position: fixed;
            font-size: 10rem !important;
            opacity: 0.1;
            z-index: -1;
            top: 10%;
            left: 10%;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--gold-dark);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 20px rgba(184, 134, 11, 0.5);
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            border-bottom: 2px gold solid;
            padding-bottom: 5px;
        }

        .btn-group {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(to bottom, var(--gold-primary), var(--gold-dark));
            border: 1px solid #8b4513;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            flex: 1;
            min-width: 100px;
        }

        button:hover {
            filter: brightness(1.1);
            box-shadow: 0 0 5px var(--gold-dark);
        }

        #status {
            background: #fff;
            border: 1px solid var(--gold-primary);
            padding: 8px;
            margin-bottom: 10px;
            min-height: 35px;
            color: #d32f2f;
            border-radius: 4px;
        }

        .data-view {
            background: #fdf5e6;
            border: 1px solid #deb887;
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .line-count {
            position: fixed;
            bottom: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: gold;
            padding: 2px 8px;
            border-radius: 3px;
            z-index: 100;
        }

        .loader {
            display: none;
            text-align: center;
            color: var(--gold-dark);
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Gemini AI API æ•´åˆæ¸¬è©¦å·¥å…· (Hex æ¨¡å¼)</h1>
    </div>

    <div id="status">ç³»çµ±å°±ç·’ã€‚è«‹å…ˆç²å– API è³‡æ–™å†é€²è¡Œ AI æ¸¬è©¦ã€‚</div>

    <div class="btn-group">
        <button onclick="fetchAndProcess()">1. ç²å–è³‡æ–™ä¸¦è½‰ Hex</button>
        <button onclick="testGeminiConnection()">2. æ¸¬è©¦ Gemini API é€£ç·š</button>
        <button onclick="askGeminiAnalysis()">3. åŸ·è¡Œ AI è³‡æ–™åˆ†æ</button>
        <button onclick="downloadCode()">ä¸‹è¼‰ç¨‹å¼ç¢¼</button>
    </div>

    <div id="ai-loader" class="loader">æ­£åœ¨é€šè¨Šä¸­ï¼Œè«‹ç¨å€™...</div>

    <div id="page-content">
        <div id="view-data" class="data-view">å°šæœªè¼‰å…¥è³‡æ–™ã€‚</div>
        <div id="view-ai" class="data-view" style="display:none;">AI çµæœå°‡é¡¯ç¤ºåœ¨æ­¤ã€‚</div>
    </div>

    <div class="pagination">
        <button onclick="showPage('data')">è³‡æ–™é è¦½ (Data)</button>
        <button onclick="showPage('ai')">AI å ±å‘Š (AI Report)</button>
    </div>
</div>

<div class="line-count" id="lineCountDisplay">ç›®å‰è¡Œæ•¸: 0</div>

<script>
    const apiUrl = "https://orlandotigereye.github.io/mytestweb/config/api.js";
    const apiKey = ""; // API å¯†é‘°ç”±ç’°å¢ƒè‡ªå‹•æä¾›
    let rawContent = "";
    let hexContent = "";

    function logMessage(msg) {
        document.getElementById('status').innerText = msg;
    }

    // 16 é€²ä½è½‰æ›å‡½å¼
    function stringToHex(str) {
        let hex = "";
        for (let i = 0; i < str.length; i++) {
            hex += str.charCodeAt(i).toString(16).padStart(2, '0');
        }
        return "0x" + hex.toUpperCase();
    }

    // ç²å–ä¸¦è™•ç†
    async function fetchAndProcess() {
        logMessage("æ­£åœ¨ç²å–é ç«¯è³‡æ–™ä¸¦è½‰æ› Key ç‚º 16 é€²ä½...");
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("HTTP " + response.status);
            const text = await response.text();
            rawContent = text;

            let result = "// --- è™•ç†å¾Œçš„ API è¨­å®šæª” ---\n";
            const lines = text.split('\n');
            lines.forEach(line => {
                const match = line.match(/^\s*["']?([\w-]+)["']?\s*:/);
                if (match) {
                    const originalKey = match[1];
                    const hexKey = stringToHex(originalKey);
                    result += line.replace(originalKey, hexKey) + " // Hex: " + hexKey + "\n";
                } else {
                    result += line + "\n";
                }
            });

            hexContent = result;
            document.getElementById('view-data').innerText = result;
            showPage('data');
            logMessage("è³‡æ–™ç²å–æˆåŠŸã€‚");
            updateLineCount();
        } catch (e) {
            logMessage("ç²å–å¤±æ•—: " + e.message);
        }
    }

    // æŒ‡æ•¸é€€é¿è«‹æ±‚
    async function fetchGemini(payload) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        let delay = 1000;
        for (let i = 0; i < 5; i++) {
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error("Status " + res.status);
                const data = await res.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "ç„¡çµæœ";
            } catch (err) {
                if (i === 4) throw err;
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
        }
    }

    // æ¸¬è©¦é€£ç·š
    async function testGeminiConnection() {
        logMessage("æ­£åœ¨æ¸¬è©¦ Gemini API é€£ç·š...");
        document.getElementById('ai-loader').style.display = "block";
        const payload = { contents: [{ parts: [{ text: "Hello, æ¸¬è©¦ API é€£ç·šæ˜¯å¦æ­£å¸¸ã€‚" }] }] };
        try {
            const result = await fetchGemini(payload);
            document.getElementById('view-ai').innerText = "é€£ç·šæ¸¬è©¦æˆåŠŸå›å‚³ï¼š\n" + result;
            showPage('ai');
            logMessage("API é€£ç·šæ¸¬è©¦æˆåŠŸã€‚");
        } catch (e) {
            logMessage("API é€£ç·šæ¸¬è©¦å¤±æ•—: " + e.message);
        } finally {
            document.getElementById('ai-loader').style.display = "none";
            updateLineCount();
        }
    }

    // AI åˆ†æè³‡æ–™
    async function askGeminiAnalysis() {
        if (!rawContent) return logMessage("è«‹å…ˆç²å–è³‡æ–™ï¼");
        logMessage("æ­£å‚³é€è³‡æ–™è‡³ Gemini é€²è¡Œåˆ†æ...");
        document.getElementById('ai-loader').style.display = "block";
        const payload = {
            contents: [{ parts: [{ text: `è«‹åˆ†æä»¥ä¸‹ API çµæ§‹å…§å®¹ï¼š\n${rawContent}` }] }],
            systemInstruction: { parts: [{ text: "ä½ æ˜¯ä¸€å€‹è»Ÿé«”é–‹ç™¼å°ˆå®¶ï¼Œè«‹ç°¡è¦è§£é‡‹æ­¤ API çš„ç”¨é€”èˆ‡å®‰å…¨æ€§ã€‚" }] }
        };
        try {
            const result = await fetchGemini(payload);
            document.getElementById('view-ai').innerText = "AI åˆ†æçµæœï¼š\n" + result;
            showPage('ai');
            logMessage("AI åˆ†æå®Œæˆã€‚");
        } catch (e) {
            logMessage("AI åˆ†æå‡ºéŒ¯: " + e.message);
        } finally {
            document.getElementById('ai-loader').style.display = "none";
            updateLineCount();
        }
    }

    function showPage(p) {
        document.getElementById('view-data').style.display = p === 'data' ? 'block' : 'none';
        document.getElementById('view-ai').style.display = p === 'ai' ? 'block' : 'none';
    }

    function downloadCode() {
        const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'gemini_api_tool.html';
        a.click();
        URL.revokeObjectURL(url);
    }

    function updateLineCount() {
        const count = document.documentElement.outerHTML.split('\n').length;
        document.getElementById('lineCountDisplay').innerText = "ç›®å‰è¨ˆç®—å¯¦éš›è¡Œæ•¸: " + count;
    }

    window.onload = updateLineCount;
</script>
</body>
</html>

