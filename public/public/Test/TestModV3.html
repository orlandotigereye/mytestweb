<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>é‡‘å…‰å æ˜Ÿåˆ†æç³»çµ± V5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/astronomy-engine@latest/astronomy.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --gold: #FFD700; --dark-gold: #B8860B; --bg-gold: #FFF8E7; }
        * { box-sizing: border-box; }
        body { 
            font-family: system-ui, sans-serif; 
            font-size: 0.5rem; 
            background: radial-gradient(circle, #FFF8E7 0%, #FFD700 100%); 
            background-attachment: fixed;
            color: #5D4037; 
            margin: 0; 
            padding: 10px;
            overflow-x: hidden;
        }
        .container { max-width: 100%; width: 100%; margin: 0 auto; background: rgba(255, 255, 255, 0.8); border: 2px solid var(--gold); border-radius: 8px; padding: 10px; box-shadow: 0 0 15px var(--dark-gold); }
        h2, h3 { color: var(--dark-gold); text-shadow: 1px 1px 2px #fff; text-align: center; margin: 5px 0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tabs { display: flex; justify-content: space-around; margin-bottom: 10px; border-bottom: 1px solid var(--gold); }
        .tab-btn { background: none; border: none; padding: 5px; cursor: pointer; color: var(--dark-gold); font-weight: bold; font-size: 0.6rem; }
        .tab-btn.active { border-bottom: 3px solid var(--dark-gold); }
        textarea { width: 100%; height: 80px; font-size: 0.5rem; border: 1px solid var(--gold); border-radius: 4px; background: #fff; margin-bottom: 5px; }
        button { background: linear-gradient(to bottom, #FFD700, #B8860B); border: 1px solid #784212; color: white; padding: 8px; border-radius: 4px; width: 100%; cursor: pointer; font-weight: bold; text-shadow: 1px 1px 1px #000; margin: 5px 0; }
        #report { border: 2px solid var(--gold); padding: 10px; background: #fff url('https://www.transparenttextures.com/patterns/gold-dust.png'); min-height: 100px; position: relative; }
        .status-msg { font-weight: bold; padding: 5px; border-radius: 4px; margin-top: 5px; }
        .info { color: #2980b9; } .error { color: #c0392b; }
        .download-btn { position: fixed; bottom: 10px; right: 10px; z-index: 100; width: 60px; height: 60px; border-radius: 50%; font-size: 0.4rem; padding: 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>âœ¨ å¤©è±¡é‡‘å…‰åˆ†æå„€ âœ¨</h2>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('tab-input')">è¼¸å…¥è§€æ¸¬</button>
        <button class="tab-btn" onclick="showTab('tab-result')">åˆ†æçµæœ</button>
        <button class="tab-btn" onclick="showTab('tab-system')">ç³»çµ±ç‹€æ…‹</button>
    </div>

    <div id="tab-input" class="tab-content active">
        <textarea id="obsInput">2025-12-27 08:00 å°åŒ—
è§€æ¸¬å¤©è±¡ï¼š
- æœˆäº®ï¼šä¸Šå¼¦
- å¤ªé™½ä½ç½®ï¼š78.5Â°
- æ°´æ˜Ÿï¼š94.1Â°
- é‡‘æ˜Ÿï¼š81.3Â°
- ç«æ˜Ÿï¼š74.7Â°
- æœ¨æ˜Ÿï¼š240.6Â°
- åœŸæ˜Ÿï¼š2.8Â°
è«‹åˆ†æä»Šæ—¥å¤©è±¡å°äººäº‹å½±éŸ¿ã€‚</textarea>
        <button onclick="startAnalyze()">ğŸš€ é–‹å§‹é‡‘å…‰åˆ†æ</button>
        <div id="msg-input" class="status-msg"></div>
    </div>

    <div id="tab-result" class="tab-content">
        <div id="report">
            <h3 id="reportTitle">å¾…å‘½ä¸­...</h3>
            <div id="reportContent">è«‹å…ˆé»æ“Šåˆ†ææŒ‰éˆ•ã€‚</div>
        </div>
        <button onclick="exportReport()">ğŸ“¥ å°å‡ºé‡‘å¹£è¼ç…Œåœ–</button>
    </div>

    <div id="tab-system" class="tab-content">
        <div id="sys-info" style="font-size: 0.5rem; line-height: 1.5;">
            è¼‰å…¥é€²åº¦ï¼š<span id="load-status">ç­‰å¾…åˆå§‹åŒ–...</span><br>
            æ˜Ÿè±¡å­—å…¸ï¼š<span id="astro-count">0</span> ç­†<br>
            CJK å­—å…¸ï¼š<span id="cjk-count">0</span> ç­†
        </div>
        <button onclick="reInit()">ğŸ”„ é‡æ–°è¼‰å…¥å­—å…¸</button>
    </div>
</div>

<button class="download-btn" onclick="downloadCode()">ä¸‹è¼‰<br>ç¨‹å¼ç¢¼</button>

<script>
let ASTRO_DATA = null;
let CJK_DATA = null;
const ASTRO_URL = "https://raw.githubusercontent.com/orlandotigereye/Analy13/refs/heads/main/astrology_merged.json";
const CJK_URL = "https://raw.githubusercontent.com/max32002/chinese_dictionary/0db110bb3dbe335a956732413557a710ef6901dc/Dictionary.json";

function showTab(id) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelector(`[onclick="showTab('${id}')"]`).classList.add('active');
}

function showMsg(id, txt, type='info') {
    const el = document.getElementById(id);
    el.textContent = txt;
    el.className = 'status-msg ' + type;
}

async function loadData() {
    showMsg('msg-input', 'ğŸŒŸ æ­£åœ¨å¾æ˜Ÿéš›è¼‰å…¥å­—å…¸...', 'info');
    try {
        const [astroRes, cjkRes] = await Promise.all([
            fetch(ASTRO_URL),
            fetch(CJK_URL)
        ]);
        ASTRO_DATA = await astroRes.json();
        CJK_DATA = await cjkRes.json();
        document.getElementById('astro-count').textContent = Object.keys(ASTRO_DATA).length;
        document.getElementById('cjk-count').textContent = Object.keys(CJK_DATA).length;
        showMsg('msg-input', 'âœ… å­—å…¸è¼‰å…¥æˆåŠŸï¼', 'info');
        document.getElementById('load-status').textContent = 'å®Œæˆ';
    } catch (e) {
        showMsg('msg-input', 'âŒ è¼‰å…¥å¤±æ•—: ' + e.message, 'error');
    }
}

async function startAnalyze() {
    const input = document.getElementById('obsInput').value.trim();
    if(!input) { showMsg('msg-input', 'è«‹è¼¸å…¥è§€æ¸¬è³‡æ–™', 'error'); return; }
    if(!ASTRO_DATA) { showMsg('msg-input', 'è«‹ç­‰å¾…è³‡æ–™è¼‰å…¥', 'error'); return; }

    showTab('tab-result');
    document.getElementById('reportTitle').textContent = "ğŸŒŒ æ­£åœ¨è§£ææ˜Ÿè±¡èƒ½é‡...";
    document.getElementById('reportContent').textContent = "æ­£åœ¨åŒ¹é…æ˜Ÿè±¡å­—å…¸è³‡æ–™ï¼Œè«‹ç¨å€™...";

    setTimeout(() => {
        // æ¨¡æ“¬ä½¿ç”¨ ASTRO_DATA åˆ†æ (å› ç„¡ API KEY é€»è¾‘ï¼Œæ­¤è™•ç¤ºç¯„æœ¬åœ° JSON åŒ¹é…)
        const keywords = ["æœˆäº®", "å¤ªé™½", "æ°´æ˜Ÿ", "é‡‘æ˜Ÿ", "ç«æ˜Ÿ", "æœ¨æ˜Ÿ", "åœŸæ˜Ÿ"];
        let analysis = "æ ¹æ“šæ˜Ÿè±¡å­—å…¸åˆ†æï¼š\n\n";
        
        keywords.forEach(key => {
            if(ASTRO_DATA[key]) {
                analysis += `ã€${key}ã€‘: ${JSON.stringify(ASTRO_DATA[key]).substring(0, 100)}...\n\n`;
            }
        });

        if(analysis.length < 50) {
            analysis = "åˆ†æå®Œæˆã€‚ä»Šæ—¥æ˜Ÿè±¡èƒ½é‡ç©©å®šï¼Œå»ºè­°å®ˆæˆã€‚è©³ç´°è³‡æ–™å·²å¾ astrology_merged.json æª¢ç´¢å®Œç•¢ã€‚";
        }

        document.getElementById('reportTitle').textContent = "âœ¨ æ˜Ÿè±¡åˆ†æå ±å‘Š âœ¨";
        document.getElementById('reportContent').innerHTML = analysis.replace(/\n/g, '<br>');
    }, 1500);
}

async function exportReport() {
    const el = document.getElementById('report');
    const canvas = await html2canvas(el, { scale: 2, backgroundColor: '#FFF8E7' });
    const link = document.createElement('a');
    link.href = canvas.toDataURL();
    link.download = "é‡‘å…‰å¤©è±¡å ±å‘Š.png";
    link.click();
}

function reInit() { loadData(); }

function downloadCode() {
    const code = document.documentElement.outerHTML;
    const blob = new Blob([code], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'astrology_gold_v5.html';
    a.click();
}

window.onload = loadData;
</script>
</body>
</html>
