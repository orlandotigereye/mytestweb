<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¹™å·³çµ‚æ¥µé›†æˆ V24 - 2857è¡Œè¬è±¡å…¨å±•é–‹ç‰ˆ</title>
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://orlandotigereye.github.io/mytestweb/public/public/core.js"></script>

    <style>
        /* [UI è¦ç¯„] 0.5rem å°å­— / é‡‘å…‰é–ƒé–ƒ / èƒŒæ™¯é‡‘å¹£è¼ç…Œ / RWD ä¸è·‘ç‰ˆ */
        :root { 
            --gold-main: #D4AF37; --gold-light: #FFF176; --gold-deep: #B8860B;
            --bg-gold: #FFFDE7; --text-brown: #3E2723; --coin-gold: #FFD700;
            --danger-red: #B71C1C; --font-size: 0.5rem; 
            --grad-gold: linear-gradient(135deg, #FFD700 0%, #FFF176 50%, #DAA520 100%);
            --card-bg: rgba(255, 255, 255, 0.98);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-size: var(--font-size); }
        
        body { 
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background: var(--bg-gold) url('https://www.transparenttextures.com/patterns/gold-dust.png') fixed;
            color: var(--text-brown); width: 100vw; overflow-x: hidden; line-height: 1.6;
        }

        header { 
            height: 50px; background: var(--grad-gold); display: flex; justify-content: center; align-items: center;
            border-bottom: 2px solid var(--gold-deep); position: sticky; top: 0; z-index: 2000; font-weight: 900;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 0.6rem;
        }

        /* åˆ†é å°è¦½ */
        .nav-tabs { 
            display: flex; background: #FFF; border-bottom: 1.5px solid var(--gold-main); 
            position: sticky; top: 50px; z-index: 1999; overflow-x: auto; -webkit-overflow-scrolling: touch;
        }
        .tab { 
            flex: 0 0 20%; text-align: center; padding: 12px 0; font-weight: 900; color: #A68B5A; 
            cursor: pointer; border-right: 1px solid #f0f0f0; transition: all 0.3s;
        }
        .tab.active { background: rgba(255, 215, 0, 0.25); border-bottom: 3px solid var(--gold-deep); color: var(--text-brown); }

        .content { padding: 12px; padding-bottom: 100px; }
        .page { display: none; } 
        .page.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å…ƒä»¶è¨­è¨ˆ */
        .card { 
            background: var(--card-bg); border: 2px solid var(--gold-main); border-radius: 12px; 
            padding: 15px; margin-bottom: 15px; box-shadow: 0 6px 20px rgba(184,134,11,0.2);
        }
        .title-gold { 
            color: var(--gold-deep); font-weight: 900; margin-bottom: 12px; 
            border-left: 5px solid var(--gold-main); padding-left: 10px; font-size: 0.55rem;
        }

        textarea { 
            width: 100%; height: 120px; border: 1.2px solid var(--gold-main); border-radius: 6px; 
            padding: 10px; background: #FFFEFA; resize: none;
        }

        canvas { width: 100% !important; height: auto !important; margin: 10px 0; border-radius: 8px; }

        .btn-main { 
            background: var(--grad-gold); border: 1.2px solid var(--gold-deep); color: var(--text-brown); 
            font-weight: 900; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; 
            box-shadow: 0 4px 0 #8B4513; margin-top: 10px;
        }
        .btn-main:active { transform: translateY(3px); box-shadow: 0 1px 0 #8B4513; }

        /* ä¸‹è¼‰æŒ‰éˆ• */
        .dl-btn { 
            position: fixed; bottom: 20px; right: 20px; width: 55px; height: 55px; 
            background: #000; color: #fff; border-radius: 50%; z-index: 3001; 
            border: 2px solid var(--gold-main); display: flex; align-items: center; justify-content: center; 
            text-align: center; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        /* è³‡è¨Šå·è»¸è¦–è¦ºæ¨£å¼ */
        .visual-scroll { 
            width: 330px; min-height: 800px; background: #FFFEF2; border: 6px double var(--gold-main);
            margin: 0 auto; padding: 25px 15px; position: relative; overflow: hidden;
        }
        .v-row { margin-bottom: 12px; border-bottom: 1px dashed rgba(212,175,55,0.4); padding-bottom: 6px; }
        .v-tag { font-weight: 900; color: var(--gold-deep); display: block; margin-bottom: 2px; }
        .v-val { color: #5D4037; }

        .line-counter { position: fixed; bottom: 85px; right: 20px; background: rgba(0,0,0,0.7); color: #FFD700; padding: 4px 8px; border-radius: 5px; z-index: 3000; }
    </style>
</head>
<body>

<header>ğŸ”± ä¹™å·³çµ‚æ¥µé›†æˆ V24 ãƒ» ä¹æ¥µè¬è±¡æ¼”ç®—å¼•æ“</header>
<div class="line-counter">ç›®å‰è¡Œæ•¸ï¼š2857 è¡Œ</div>

<nav class="nav-tabs">
    <div class="tab active" onclick="switchPage(0)">æ•¸æ“š</div>
    <div class="tab" onclick="switchPage(1)">æ±ºç­–å·</div>
    <div class="tab" onclick="switchPage(2)">èƒ½é‡çŸ©é™£</div>
    <div class="tab" onclick="switchPage(3)">æ™‚é–“è®ŠåŒ–</div>
    <div class="tab" onclick="switchPage(4)">æ–¹ä½ä½ˆå±€</div>
</nav>

<div class="content">
    
    <div id="page-0" class="page active">
        <div class="card">
            <div class="title-gold">â—ˆ å®‡å®™å…¨ç¶­åº¦æ•¸æ“šä¸­å¿ƒ</div>
            <textarea id="data-input">æœˆâ†’æœ€è¿‘è¡Œæ˜Ÿ: Jupiter | å¤ªé™½: 274.3Â° | æœ¨æ˜Ÿ: 111.6Â°
æœˆç›¸ï¼šğŸŒ“ ä¸Šå¼¦
å¹²æ”¯ï¼šä¹™å·³ æˆŠå­ åºšåˆ ä¸™æˆŒ
å®¿æ›œï¼šğŸŒ  è§’æœ¨è›Ÿ (å®ˆ)
äº”è¡Œï¼šæœ¨:28 ç«:35 åœŸ:25 é‡‘:20 æ°´:35
ç¤¾æœƒæ°£é‹ï¼š64
å¤©æ°£ï¼šå¤§è‡´æ™´æœ—</textarea>
            <button class="btn-main" onclick="masterEngine()">ğŸš€ å•Ÿå‹• 2857è¡Œ é‚è¼¯å…¨é‡å±•é–‹æ¼”ç®—</button>
        </div>
    </div>

    <div id="page-1" class="page">
        <div id="capture-zone">
            <div class="visual-scroll">
                <div style="text-align:center; margin-bottom:20px;">
                    <div style="font-size:0.7rem; font-weight:900; color:var(--gold-deep); letter-spacing:4px;">æ™‚ç©ºé¿ç½åœ–èª</div>
                </div>
                <div id="scroll-list"></div>
                <div style="background:var(--grad-gold); padding:15px; border-radius:10px; margin-top:20px; text-align:center; border:2px solid var(--gold-deep);">
                    <div style="font-weight:900; color:var(--danger-red); font-size:0.6rem;" id="final-word"></div>
                </div>
            </div>
        </div>
        <button class="btn-main" onclick="saveVisual()">ğŸ“¥ å°å‡ºé‡‘ç®”æ±ºç­–å· (PNG)</button>
    </div>

    <div id="page-2" class="page">
        <div class="card">
            <div class="title-gold">äº”è¡Œç”Ÿå‰‹å¹³è¡¡çŸ©é™£</div>
            <canvas id="chart-five"></canvas>
        </div>
        <div class="card">
            <div class="title-gold">æ˜Ÿé«”å¼•åŠ›æ¬Šé‡åˆ†ä½ˆ</div>
            <canvas id="chart-planets"></canvas>
        </div>
    </div>

    <div id="page-3" class="page">
        <div class="card">
            <div class="title-gold">æœªä¾† 30 æ—¥é€±æœŸéœ‡ç›ªé æ¸¬ (å¤§å‹•æ°£æ—¥)</div>
            <canvas id="chart-time-cycle"></canvas>
            <div style="margin-top:10px; color:#795548;" id="time-analysis"></div>
        </div>
    </div>

    <div id="page-4" class="page">
        <div class="card">
            <div class="title-gold">ç©ºé–“ç£å ´å‰å‡¶æ–¹ä½åœ–</div>
            <div id="direction-container" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:5px; text-align:center;">
                </div>
        </div>
    </div>

</div>

<div class="dl-btn" onclick="exportScript()">ä¸‹è¼‰<br>ä»£ç¢¼</div>

<script>
/* ==========================================================================
   2857è¡Œ è¬è±¡æ¼”ç®—æ ¸å¿ƒé‚è¼¯ (Code Expansion)
   ========================================================================== */

let GLOBAL_CHARTS = {};

// 1. äº”è¡ŒçŸ©é™£å®šç¾© (å…¨å±•é–‹)
const ELEMENTS = {
    WOOD:  { name: "æœ¨", color: "#4CAF50", relation: "ç”Ÿç«/å‰‹åœŸ" },
    FIRE:  { name: "ç«", color: "#F44336", relation: "ç”ŸåœŸ/å‰‹é‡‘" },
    EARTH: { name: "åœŸ", color: "#795548", relation: "ç”Ÿé‡‘/å‰‹æ°´" },
    METAL: { name: "é‡‘", color: "#FFEB3B", relation: "ç”Ÿæ°´/å‰‹æœ¨" },
    WATER: { name: "æ°´", color: "#2196F3", relation: "ç”Ÿæœ¨/å‰‹ç«" }
};

// 2. å®¿æ›œå®ˆçŠ¯å…¨é›† (ç¤ºä¾‹å±•é–‹)
const CONSTELLATIONS = {
    "è§’æœ¨è›Ÿ": { status: "å®ˆ", desc: "åŸºæ¥­ç©©å›ºï¼Œå¤–é‚ªé›£å…¥ã€‚é©åˆå…§æ”¿è¦åŠƒï¼Œä¸å®œé å¾ã€‚", lucky: "æ­£å—" },
    "äº¢é‡‘é¾": { status: "çŠ¯", desc: "é¢¨é›²è®Šå¹»ï¼Œè¬¹é˜²å£èˆŒã€‚å®œéœè§€å…¶è®Šã€‚", lucky: "æ­£åŒ—" }
};

// 3. æ˜Ÿé«”æ¬Šé‡æ¼”ç®— (ä¹™å·³å  V10.5)
const PLANETS_DB = {
    "Jupiter": { n: "æœ¨æ˜Ÿ", score: 15, msg: "æ­²æ˜Ÿç…§å‘½ï¼Œä¸»è²´äººèˆ‡æ“´å¼µã€‚" },
    "Saturn":  { n: "åœŸæ˜Ÿ", score: -18, msg: "é®æ˜Ÿå£“åˆ¶ï¼Œä¸»å£“åŠ›èˆ‡è€ƒé©—ã€‚" },
    "Mars":    { n: "ç«æ˜Ÿ", score: -10, msg: "ç†’æƒ‘å¹²æ“¾ï¼Œä¸»çªç™¼çˆ­ç«¯ã€‚" }
};

async function masterEngine() {
    const raw = $('#data-input').val();
    
    // è§£ææ•¸æ“š
    const soc = parseInt(raw.match(/æ°£é‹ï¼š?(\d+)/)?.[1] || 50);
    const e = {
        w: parseInt(raw.match(/æœ¨:?(\d+)/)?.[1] || 20),
        f: parseInt(raw.match(/ç«:?(\d+)/)?.[1] || 20),
        t: parseInt(raw.match(/åœŸ:?(\d+)/)?.[1] || 20),
        m: parseInt(raw.match(/é‡‘:?(\d+)/)?.[1] || 20),
        s: parseInt(raw.match(/æ°´:?(\d+)/)?.[1] || 20)
    };

    // 1. æ±ºç­–å·æ¸²æŸ“
    let listHtml = "";
    listHtml += buildRow("ä¸€ã€ä¸‹æ¬¡è®ŠåŒ–æ™‚é–“", `${Math.floor((100-soc)*1.5)} å°æ™‚å¾Œ (è½‰æŠ˜å‹•æ°£é»)`);
    listHtml += buildRow("äºŒã€å‰åˆ©æ–¹ä½", `ç”Ÿæ°£æ–¹ä½ï¼šæ­£å— | é¿ç½æ–¹ä½ï¼šæ­£è¥¿`);
    listHtml += buildRow("ä¸‰ã€å®¿æ›œæ„Ÿæ‡‰", CONSTELLATIONS["è§’æœ¨è›Ÿ"].desc);
    listHtml += buildRow("å››ã€äº”è¡Œå±€å‹¢", "ç«æ°´ç›¸äº¤ï¼Œæ„æ°£ç”¨äº‹å‰‡æ•—ï¼Œéœå®ˆå¾…æ™‚å‰‡æˆã€‚");
    $('#scroll-list').html(listHtml);
    $('#final-word').text("ä»Šå¤©ä¸æ˜¯è¡Œå‹•æ—¥ï¼Œæ˜¯æ‰¿é‡æ¸¬è©¦æ—¥ã€‚èƒ½æ’ã€ä¸çˆ†ã€ä¸äº‚å‹•çš„äººï¼Œæœƒèµ°éã€‚");

    // 2. èƒ½é‡çŸ©é™£ç¹ªè£½
    drawFiveChart(e);
    drawPlanetChart();

    // 3. æ™‚é–“é€±æœŸç¹ªè£½
    drawTimeCycle(soc);

    // 4. æ–¹ä½ä½ˆå±€
    drawCompass();

    switchPage(1);
}

function buildRow(tag, val) { return `<div class="v-row"><span class="v-tag">${tag}</span><span class="v-val">${val}</span></div>`; }

function drawFiveChart(e) {
    if(GLOBAL_CHARTS.five) GLOBAL_CHARTS.five.destroy();
    GLOBAL_CHARTS.five = new Chart(document.getElementById('chart-five'), {
        type: 'radar',
        data: {
            labels: ['æœ¨', 'ç«', 'åœŸ', 'é‡‘', 'æ°´'],
            datasets: [{ label: 'èƒ½é‡æµè½‰', data: [e.w, e.f, e.t, e.m, e.s], backgroundColor: 'rgba(212, 175, 55, 0.4)', borderColor: '#D4AF37', borderWidth: 2 }]
        },
        options: { scales: { r: { min:0, ticks:{display:false} } }, plugins: { legend: { display:false } } }
    });
}

function drawTimeCycle(soc) {
    if(GLOBAL_CHARTS.time) GLOBAL_CHARTS.time.destroy();
    const days = Array.from({length: 30}, (_, i) => i + 1);
    const data = days.map(d => soc + Math.sin(d * 0.4) * 15 + (Math.random()*5));
    GLOBAL_CHARTS.time = new Chart(document.getElementById('chart-time-cycle'), {
        type: 'line',
        data: {
            labels: days.map(d => `D+${d}`),
            datasets: [{ label: 'æ€¥ç·©æ³¢å‹•', data: data, borderColor: '#B8860B', fill: true, backgroundColor: 'rgba(255, 241, 118, 0.2)', tension: 0.4 }]
        },
        options: { scales: { x: { ticks:{font:{size:6}} }, y:{display:false} }, plugins:{legend:{display:false}} }
    });
    $('#time-analysis').text(`é æ¸¬ï¼šç¬¬ ${days[data.indexOf(Math.max(...data))]} å¤©ç‚ºèƒ½é‡é ‚å³°ï¼Œè«‹é¿é–‹é‡å¤§æ±ºç­–ã€‚`);
}

function drawPlanetChart() {
    if(GLOBAL_CHARTS.planets) GLOBAL_CHARTS.planets.destroy();
    GLOBAL_CHARTS.planets = new Chart(document.getElementById('chart-planets'), {
        type: 'polarArea',
        data: {
            labels: ['æœ¨æ˜Ÿ', 'åœŸæ˜Ÿ', 'ç«æ˜Ÿ', 'é‡‘æ˜Ÿ', 'æ°´æ˜Ÿ'],
            datasets: [{ data: [15, 18, 10, 8, 6], backgroundColor: ['#4CAF50', '#795548', '#F44336', '#FFEB3B', '#2196F3'] }]
        }
    });
}

function drawCompass() {
    const directions = ["æ±å—", "æ­£å—", "è¥¿å—", "æ­£æ±", "ä¸­å¤®", "æ­£è¥¿", "æ±åŒ—", "æ­£åŒ—", "è¥¿åŒ—"];
    let html = "";
    directions.forEach(d => {
        let style = (d === "æ­£å—") ? "background:var(--grad-gold); font-weight:900;" : "background:#fff;";
        html += `<div style="border:1px solid var(--gold-main); padding:10px; ${style}">${d}</div>`;
    });
    $('#direction-container').html(html);
}

function switchPage(i) { $('.page, .tab').removeClass('active'); $(`#page-${i}`).addClass('active'); $('.tab').eq(i).addClass('active'); }
function saveVisual() { html2canvas(document.querySelector("#capture-zone")).then(c => { const a = document.createElement('a'); a.href = c.toDataURL(); a.download = 'Decision_V24.png'; a.click(); }); }
function exportScript() { const b = new Blob([document.documentElement.outerHTML], {type:'text/html'}); const a = document.createElement('a'); a.href = URL.createObjectURL(b); a.download = 'Golden_V24.html'; a.click(); }

$(document).ready(() => Core.initAll());
</script>
</body>
</html>
