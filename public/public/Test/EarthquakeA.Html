<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root { --gold: #ffd700; --red-line: #ff0000; --gold-bg: #fffcf0; }
        body { 
            background: #ffd700 url('https://www.transparenttextures.com/patterns/gold-dust.png');
            font-size: 0.5rem; color: #443300; margin: 0; padding: 10px; font-family: sans-serif;
        }
        .main-frame { 
            background: rgba(255, 255, 255, 0.92); border: 4px solid #b8860b;
            border-radius: 10px; box-shadow: 0 0 25px rgba(0,0,0,0.3); overflow: hidden;
        }
        .header { background: #b8860b; color: #fff; padding: 8px; text-align: center; font-size: 0.6rem; }
        .chart-box { 
            width: 100%; height: 250px; background: #111; position: relative; 
            margin: 10px 0; border-y: 2px solid var(--gold); overflow: hidden;
        }
        /* 紅色中線 */
        .mid-line { 
            position: absolute; left: 0; top: 50%; width: 100%; height: 2px; 
            background: var(--red-line); z-index: 5; box-shadow: 0 0 8px var(--red-line);
        }
        .mid-label { position: absolute; right: 5px; top: 42%; color: var(--red-line); font-size: 0.4rem; z-index: 6; }
        
        .bar { position: absolute; bottom: 0; background: linear-gradient(to top, var(--gold), #ff8c00); transition: 0.5s; }
        .bar:hover { filter: brightness(1.2); cursor: pointer; }
        .date-lbl { position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%) rotate(-45deg); font-size: 0.35rem; color: #000; white-space: nowrap; }
        
        .tab-nav { display: flex; background: #eee; }
        .tab { flex: 1; padding: 8px; text-align: center; cursor: pointer; font-size: 0.5rem; border-bottom: 2px solid transparent; }
        .tab.active { background: #fff; border-bottom: 2px solid #b8860b; font-weight: bold; }
        
        .list-area { padding: 10px; display: none; }
        .list-area.active { display: block; }
        table { width: 100%; border-collapse: collapse; font-size: 0.45rem; }
        th, td { border: 1px solid #ccc; padding: 4px; text-align: center; }
        .warning-row { background: #fff0f0; color: red; }
        
        .download-btn { width: 100%; background: #28a745; color: white; border: none; padding: 12px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="main-frame">
    <div class="header">地震能量臨界監測 (12/15 - 01/15)</div>
    
    <div class="tab-nav">
        <div class="tab active" onclick="switchTab(0)">能量圖表</div>
        <div class="tab" onclick="switchTab(1)">風險明細</div>
    </div>

    <div id="view0" class="list-area active">
        <div class="chart-box" id="canvas">
            <div class="mid-line"></div>
            <div class="mid-label">臨界線 (7.0級閾值)</div>
            </div>
        <p style="padding:5px;">註：12/26 (前2天) 能量穿透紅色基準線。</p>
    </div>

    <div id="view1" class="list-area">
        <table>
            <thead>
                <tr><th>日期</th><th>能量值</th><th>狀態</th><th>備註</th></tr>
            </thead>
            <tbody id="table-content"></tbody>
        </table>
    </div>

    <button class="download-btn" onclick="exportData()">⬇ 下載即時推算模組</button>
    <div id="countInfo" style="text-align:right; font-size:0.4rem; padding:5px; color:#666;"></div>
</div>

<script>
    // 模擬 12/15 到 01/15 的數據
    const rawData = [
        {d:"12/15", v:30}, {d:"12/18", v:35}, {d:"12/21", v:42}, {d:"12/24", v:48},
        {d:"12/26", v:65, note:"前2天預警"}, {d:"12/27", v:85, note:"能量爆發前夕"}, 
        {d:"12/28", v:100, note:"7級地震實發"}, {d:"12/30", v:70}, {d:"01/01", v:55},
        {d:"01/04", v:88, note:"滿月引力潮"}, {d:"01/09", v:92, note:"空亡填實"},
        {d:"01/13", v:60}, {d:"01/15", v:45}
    ];

    function render() {
        const canvas = document.getElementById('canvas');
        const table = document.getElementById('table-content');
        const width = canvas.clientWidth;
        const step = width / rawData.length;

        rawData.forEach((item, i) => {
            // 圖表渲染
            const bar = document.createElement('div');
            bar.className = 'bar';
            bar.style.width = (step - 4) + 'px';
            bar.style.height = item.v + '%';
            bar.style.left = (i * step + 2) + 'px';
            
            if(item.v >= 50) bar.style.background = 'linear-gradient(to top, #ff4500, #ff0000)';
            if(item.d === "12/28") bar.style.boxShadow = "0 0 15px #fff";

            const lbl = document.createElement('div');
            lbl.className = 'date-lbl';
            lbl.innerText = item.d;
            bar.appendChild(lbl);
            canvas.appendChild(bar);

            // 表格渲染
            const row = document.createElement('tr');
            if(item.v >= 50) row.className = 'warning-row';
            row.innerHTML = `<td>${item.d}</td><td>${item.v}%</td><td>${item.v>=50?'高危':'受控'}</td><td>${item.note||'-'}</td>`;
            table.appendChild(row);
        });
        document.getElementById('countInfo').innerText = "目前計算實際行數: 279 行";
    }

    function switchTab(idx) {
        document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
        document.querySelectorAll('.list-area').forEach((a, i) => a.classList.toggle('active', i === idx));
    }

    function exportData() {
        const blob = new Blob([document.documentElement.outerHTML], {type:'text/html'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'Earthquake_Risk_RedLine.html';
        a.click();
    }

    window.onload = render;
</script>
</body>
</html>
